name: Test All Actions

on:
    workflow_dispatch: # Manual trigger - works on any branch
        inputs:
            state:
                description: "State abbreviation to test (e.g., id, il, tx, ny, or usa)"
                required: true
                default: "id"
            test-sources:
                description: "Test sources action"
                required: false
                default: true
                type: boolean
            test-scrape:
                description: "Test scrape action"
                required: false
                default: true
                type: boolean
            test-format:
                description: "Test format action"
                required: false
                default: true
                type: boolean
            test-extract:
                description: "Test extract action"
                required: false
                default: false
                type: boolean
            test-recent-items:
                description: "Test recent-items action"
                required: false
                default: true
                type: boolean

jobs:
    test-sources:
        if: ${{ inputs.test-sources != 'false' }}
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  ref: ${{ github.ref }}

            - name: Test Sources Action
              uses: ./actions/sources
              with:
                  sources: |
                      windy-civi-pipelines/usa-data-pipeline
                  token: ${{ secrets.GITHUB_TOKEN }}

    test-recent-items:
        if: ${{ inputs.test-recent-items != 'false' }}
        needs: test-sources
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  ref: ${{ github.ref }}

            - name: Test Sources Action (for recent-items)
              id: sources
              uses: ./actions/sources
              with:
                  sources: |
                      windy-civi-pipelines/usa-data-pipeline
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: Test Recent Items Action
              uses: ./actions/recent-items
              with:
                  limit: "100"
                  output_file: "test_recent_items.txt"
